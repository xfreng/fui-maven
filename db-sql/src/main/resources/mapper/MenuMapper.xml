<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.fui.dao.menu.MenuMapper">
	<select id="query" resultType="java.util.HashMap">
	    SELECT 
	      tree_ename      as "parent", 
	      node_ename      as "label", 
	      node_cname      as "text",
	      node_image_path as "imagePath",
	      node_type       as "leaf",
	      node_url 		  as "url"
	    FROM 
	    fui.fui_menu
	    WHERE 1=1
      	<if test="node != null and node != ''">
        	and tree_ename = #{node}
        </if>
	    order by tree_ename asc, node_sort_id asc, node_ename asc 
  	</select>
  	
	<select id="count" resultType="java.lang.Integer">
	    SELECT 
	      count(*)
	    FROM 
	    fui.fui_menu
	    WHERE 1=1
      	<if test="node != null and node != ''">
        	and tree_ename = #{node}
        </if>
  	</select>
  	
	<select id="queryMenuNodeById" resultType="com.fui.model.Menu">
		SELECT
			rec_creator     as "recCreator",
	      	rec_create_time as "recCreateTime",
	      	rec_revisor     as "recRevisor",
	      	rec_revise_time as "recReviseTime",
	      	archive_flag    as "archiveFlag",
			tree_ename as "pid",
			node_ename as "id",
			node_cname as "text",
			node_type  as "type",
			node_url   as "url",
			node_sort_id    as "sortId",
      		node_param	as "param",
      		node_image_path as "image"
		FROM
		fui.fui_menu 
		WHERE 1=1
        <if test="id != null and id != ''">
        	and tree_ename = #{id}
        </if>
        <if test="node != null and node != ''">
        	and node_ename = #{node}
        </if>
		order by tree_ename asc, node_sort_id asc, node_ename asc
	</select>

	<select id="queryMenuNodeById_page" resultType="com.fui.model.Menu">
		SELECT
			rec_creator     as "recCreator",
			rec_create_time as "recCreateTime",
			rec_revisor     as "recRevisor",
			rec_revise_time as "recReviseTime",
			archive_flag    as "archiveFlag",
			tree_ename as "pid",
			node_ename as "id",
			node_cname as "text",
			node_type  as "type",
			node_url   as "url",
			node_sort_id    as "sortId",
			node_param	as "param",
			node_image_path as "image"
		FROM
		fui.fui_menu
		WHERE 1=1
		<if test="id != null and id != ''">
			and tree_ename = #{id}
		</if>
		<if test="node != null and node != ''">
			and node_ename = #{node}
		</if>
		order by tree_ename asc, node_sort_id asc, node_ename asc
	</select>
	
	<insert id="insertMenuNode" parameterType="com.fui.model.Menu">
		insert into 
			fui.fui_menu
		(
			rec_creator,
			rec_create_time,
			rec_revisor,
			rec_revise_time,
			archive_flag,
			tree_ename,
			node_ename,
			node_cname,
			node_type,
			node_url,
			node_sort_id,
			node_param,
			node_image_path
		)
		values
		(
			#{recCreator},
			#{recCreateTime},
			#{recRevisor},
			#{recReviseTime},
			#{archiveFlag},
			#{pid},
			#{id},
			#{text},
			#{type},
			#{url},
			#{sortId},
			#{param},
			#{image}
		)
	</insert>
	
	<update id="deleteMenuNodeById" parameterType="com.fui.model.Menu">
        delete from
        	fui.fui_menu 
       	where tree_ename=#{pid} and node_ename=#{id}
    </update>
    
	<update id="updateMenuNodeById" parameterType="com.fui.model.Menu">
        update 
        	fui.fui_menu 
       	set 
	       	rec_revisor=#{recRevisor},
	       	rec_revise_time=#{recReviseTime},
	       	node_cname=#{text},
	       	node_type=#{type},
	       	node_sort_id=#{sortId},
	       	node_url=#{url},
	       	node_image_path=#{image}
       	where tree_ename=#{pid} and node_ename=#{id}
    </update>
</mapper>
